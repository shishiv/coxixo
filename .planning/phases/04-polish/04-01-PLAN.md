---
phase: 04-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Coxixo/TrayApplicationContext.cs
  - Coxixo/Resources/icon-idle.ico
  - Coxixo/Resources/icon-recording.ico
  - Coxixo/Resources/icon-recording-pulse.ico
  - Coxixo/Coxixo.csproj
autonomous: true

must_haves:
  truths:
    - "Tray icon displays 3 bars forming C shape when app is idle"
    - "Tray icon turns red with pulsing dot when recording"
    - "Icon animation pulses visibly during recording state"
    - "Icons are legible at 16x16 tray size"
  artifacts:
    - path: "Coxixo/Resources/icon-idle.ico"
      provides: "White/gray sound bar icon for idle state"
    - path: "Coxixo/Resources/icon-recording.ico"
      provides: "Red sound bar icon for recording (frame 1)"
    - path: "Coxixo/Resources/icon-recording-pulse.ico"
      provides: "Red sound bar icon with dot for recording (frame 2)"
    - path: "Coxixo/TrayApplicationContext.cs"
      provides: "Timer-based icon animation during recording"
      contains: "_animationTimer"
  key_links:
    - from: "TrayApplicationContext.cs"
      to: "icon-recording*.ico"
      via: "Timer cycling between frames"
      pattern: "_recordingFrames\\[_currentFrame\\]"
---

<objective>
Implement brand-compliant tray icons with recording animation.

Purpose: Apply Coxixo visual identity to the system tray - the most visible part of the app. The brand guide specifies 3 sound bars forming a "C" shape with green accent dot, white/gray when idle, red with pulsing indicator when recording.

Output: Brand-compliant .ico files and timer-based animation in TrayApplicationContext.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish/04-RESEARCH.md
@Coxixo/TrayApplicationContext.cs
@coxixo-brand-guides.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create brand-compliant tray icons programmatically</name>
  <files>
    Coxixo/Resources/icon-idle.ico
    Coxixo/Resources/icon-recording.ico
    Coxixo/Resources/icon-recording-pulse.ico
    Coxixo/Coxixo.csproj
  </files>
  <action>
Create .ico files that match the brand guide design using System.Drawing at build time or a helper script.

Icon design (based on brand guide SVG viewBox 0 0 100 100, scaled to 16x16):
- 3 vertical bars forming "C" shape:
  - Bar 1: x=25%, height=50%, full opacity
  - Bar 2: x=50%, height=70%, 80% opacity
  - Bar 3: x=75%, height=30%, 60% opacity
- Bars have rounded ends (rx in SVG)

Create 3 icons:
1. **icon-idle.ico** (16x16):
   - Bars in white (#FFFFFF) or light gray (#C0C0C0) for Windows dark taskbar visibility
   - Small green dot (#00CC6A) in bottom-right corner (the accent from brand guide)

2. **icon-recording.ico** (16x16):
   - Bars in red (#E81123)
   - No dot (will alternate with pulse version)

3. **icon-recording-pulse.ico** (16x16):
   - Bars in red (#E81123)
   - Red pulsing dot in top-right corner

Approach options (choose simplest):
A) Create a console script that generates .ico using System.Drawing.Bitmap and saves to Resources/
B) Use online icon generator with the exact pixel specifications
C) Create Bitmap programmatically at app startup (not recommended - complexity)

For option A, create a one-time script:
```csharp
// Generate 16x16 icon with 3 bars
var bmp = new Bitmap(16, 16);
using var g = Graphics.FromImage(bmp);
g.SmoothingMode = SmoothingMode.AntiAlias;
// Draw bars...
// Save as .ico
```

Ensure icons are embedded resources in .csproj:
```xml
<ItemGroup>
  <EmbeddedResource Include="Resources\icon-idle.ico" />
  <EmbeddedResource Include="Resources\icon-recording.ico" />
  <EmbeddedResource Include="Resources\icon-recording-pulse.ico" />
</ItemGroup>
```
  </action>
  <verify>
- `ls Coxixo/Resources/*.ico` shows 3 icon files
- `dotnet build Coxixo/Coxixo.csproj` succeeds
- Icons visible when opened in image viewer
  </verify>
  <done>
3 brand-compliant .ico files exist as embedded resources:
- icon-idle.ico: white/gray bars with green dot
- icon-recording.ico: red bars without dot
- icon-recording-pulse.ico: red bars with red dot
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement timer-based recording animation in TrayApplicationContext</name>
  <files>Coxixo/TrayApplicationContext.cs</files>
  <action>
Modify TrayApplicationContext to animate tray icon during recording state.

Changes:
1. Add fields for animation:
   ```csharp
   private System.Windows.Forms.Timer? _animationTimer;
   private Icon[] _recordingFrames = null!;
   private int _currentFrame = 0;
   private readonly Icon _recordingPulseIcon;
   ```

2. Load the new pulse icon in constructor:
   ```csharp
   _recordingPulseIcon = LoadEmbeddedIcon("Coxixo.Resources.icon-recording-pulse.ico");
   ```

3. Initialize _recordingFrames array after loading icons:
   ```csharp
   _recordingFrames = new[] { _recordingIcon, _recordingPulseIcon };
   ```

4. Create animation methods:
   ```csharp
   private void StartRecordingAnimation()
   {
       _currentFrame = 0;
       _trayIcon.Icon = _recordingFrames[0];

       _animationTimer = new System.Windows.Forms.Timer();
       _animationTimer.Interval = 500; // 500ms pulse
       _animationTimer.Tick += OnAnimationTick;
       _animationTimer.Start();
   }

   private void OnAnimationTick(object? sender, EventArgs e)
   {
       _currentFrame = (_currentFrame + 1) % _recordingFrames.Length;
       _trayIcon.Icon = _recordingFrames[_currentFrame];
   }

   private void StopRecordingAnimation()
   {
       _animationTimer?.Stop();
       _animationTimer?.Dispose();
       _animationTimer = null;
       _currentFrame = 0;
       _trayIcon.Icon = _idleIcon;
   }
   ```

5. Update OnHotkeyPressed to call StartRecordingAnimation() instead of setting icon directly:
   ```csharp
   private void OnHotkeyPressed(object? sender, EventArgs e)
   {
       StartRecordingAnimation();  // replaces: _trayIcon.Icon = _recordingIcon;
       _trayIcon.Text = "Coxixo - Recording...";
       _audioCaptureService.StartCapture();
   }
   ```

6. Update OnHotkeyReleased to call StopRecordingAnimation() instead of setting icon directly:
   ```csharp
   // In OnHotkeyReleased, replace:
   // _trayIcon.Icon = _idleIcon;
   // with:
   StopRecordingAnimation();
   ```

7. Dispose animation timer and pulse icon in Dispose():
   ```csharp
   _animationTimer?.Dispose();
   _recordingPulseIcon?.Dispose();
   ```

Pattern reference: See 04-RESEARCH.md "Pattern 2: Timer-Based Icon Animation"
  </action>
  <verify>
- `dotnet build Coxixo/Coxixo.csproj` succeeds
- Run app, hold hotkey: icon visibly pulses between frames
- Release hotkey: icon returns to idle state (white/gray bars)
  </verify>
  <done>
Tray icon animates during recording:
- Pressing hotkey starts 500ms pulse animation
- Releasing hotkey stops animation and shows idle icon
- Timer properly disposed on exit
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Build succeeds: `dotnet build Coxixo/Coxixo.csproj`
2. Run the app: `dotnet run --project Coxixo/Coxixo.csproj`
3. Observe tray icon shows brand design (3 bars, white/gray)
4. Hold hotkey (F8): icon turns red and pulses
5. Release hotkey: icon returns to idle state
6. Exit app: no ghost icons or timer errors
</verification>

<success_criteria>
- UI-01 satisfied: Tray icon uses 3-bar sound design per brand guide
- UI-02 satisfied: White/gray when idle, red with pulsing dot when recording
- Animation is visible and responsive (500ms interval)
- No GDI handle leaks (icons properly disposed)
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish/04-01-SUMMARY.md`
</output>
